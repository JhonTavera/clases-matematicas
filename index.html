<!doctype html>
<html lang="es">
<head>
  <meta name="google-site-verification" content="BLKs_-ciNXuEIIuRlkfnAwS2pvIhlNUR5qeVY9FW7Oc" />
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Clases de Matemáticas</title>

  <!-- Anti-caché del HTML base (opcional) -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />

  <style>
    :root { --maxw: 980px; --line:#e8e9ef; --ink:#111; --muted:#555; --accent:#0b63c5; }
    * { box-sizing: border-box; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 0; color: var(--ink); background: #fff; }
    header { padding: 2rem 1rem; background: #f6f7fb; border-bottom: 1px solid var(--line); }
    h1 { margin: 0 0 .5rem; font-size: clamp(1.6rem, 3vw, 2.2rem); }
    .container { max-width: var(--maxw); margin: 0 auto; padding: 1rem; }
    .toolbar { display: grid; gap: .75rem; grid-template-columns: 1fr 1fr; align-items: center; }
    .toolbar input, .toolbar select { padding: .7rem .8rem; border: 1px solid #d7d8e0; border-radius: .6rem; }
    .toolbar .btn { justify-self: end; padding: .6rem .8rem; border: 1px solid #d7d8e0; border-radius: .6rem; background:#fff; cursor:pointer; }
    @media (max-width: 700px) { .toolbar { grid-template-columns: 1fr; } .toolbar .btn { justify-self: start; } }
    .course { border: 1px solid var(--line); border-radius: .9rem; padding: 1rem; margin: 1rem 0; background: #fff; }
    .course h2 { margin: 0 0 .5rem; font-size: 1.2rem; }
    .list { display: grid; gap: .5rem; }
    .pdf { display: flex; align-items: center; justify-content: space-between; padding: .65rem .8rem; border: 1px solid #ececf3; border-radius: .6rem; }
    .pdf a { text-decoration: none; color: #0b63c5; word-break: break-word; }
    .badge { font-size: .75rem; padding: .2rem .5rem; border-radius: .5rem; background: #eef6ff; color: #0b63c5; }
    footer { text-align: center; font-size: .85rem; color: #555; padding: 2rem 1rem; }
    .details { border: 1px solid #ececf3; border-radius: .6rem; padding: .6rem .8rem; background: #fcfcff; margin: .5rem 0; }
    details > summary { cursor: pointer; font-weight: 600; color: #0b63c5; }

    /* Puerta de acceso */
    .gate { position: fixed; inset: 0; z-index: 9999; background: rgba(255,255,255,0.96); display: none; align-items: center; justify-content: center; }
    .gate.show { display: flex; }
    .gate .panel { width: min(420px, 92vw); background: #fff; border: 1px solid var(--line); border-radius: .9rem; padding: 1rem; box-shadow: 0 10px 30px rgba(0,0,0,.06); }
    .gate h2 { margin: 0 0 .25rem; font-size: 1.2rem; }
    .gate p { margin: .2rem 0 .8rem; color: var(--muted); }
    .gate input { width: 100%; padding: .75rem .85rem; border: 1px solid #d7d8e0; border-radius: .6rem; }
    .gate .row { display: grid; grid-template-columns: 1fr auto; gap: .6rem; margin-top: .8rem; }
    .gate button { padding: .75rem 1rem; border: 1px solid #0b63c5; background: #0b63c5; color: #fff; border-radius: .6rem; cursor: pointer; }
    .gate .err { color: #b00020; font-size: .9rem; margin-top: .5rem; min-height: 1.2em; }
  </style>

  <!-- MathJax -->
  <script>
    window.MathJax = {
      tex: { inlineMath: [['\\(','\\)'], ['$', '$']], displayMath: [['\\[','\\]'], ['$$','$$']], processEscapes: true },
      svg: { fontCache: 'global' }
    };
  </script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
</head>
<body>
  <header>
    <div class="container">
      <h1>Clases de Matemáticas</h1>
      <p>Material organizado por curso. Haz clic para abrir los recursos.</p>
      <div class="toolbar">
        <input id="q" type="search" placeholder="Buscar (ej: derivadas, ecuaciones)…" />
        <select id="courseFilter"><option value="">Todos los cursos</option></select>
        <button id="changeKey" class="btn" type="button">Cambiar clave</button>
      </div>
    </div>
  </header>

  <main class="container">
    <div id="root"></div>
  </main>

  <footer>
    © <span id="year"></span> • Edita la lista en <code>DATA</code> dentro de <code>index.html</code>.
  </footer>

  <!-- Puerta de acceso -->
  <div id="gate" class="gate" aria-hidden="true">
    <div class="panel">
      <h2>Ingresa la clave del curso</h2>
      <p>Escribe <strong>precalculo</strong> o <strong>teoriadenumeros</strong> (sin espacios).</p>
      <div class="row">
        <input id="gateInput" placeholder="Clave de curso" autocomplete="off" />
        <button id="gateBtn" type="button">Entrar</button>
      </div>
      <div class="err" id="gateErr"></div>
    </div>
  </div>

  <script>
  // ===== Versionado automático para romper caché en recursos =====
  const SITE_VERSION = new Date(document.lastModified).getTime().toString(36);

  // ====== Claves -> nombres exactos de curso en DATA ======
  const CODES = {
    "precalculo": "Precálculo",
    "teoriadenumeros": "Teoría de números"
  };

  // === EDITA AQUÍ: lista de cursos y PDFs ===========================
  const DATA = {
    "Precálculo": {
      sections: {
        "Clases": [
          { titulo: "Clase 1", archivo: "cursos/precalculo/clase1.pdf" },
          { titulo: "Clase 2", archivo: "cursos/precalculo/clase2.pdf" },
          { titulo: "Clase 3", archivo: "cursos/precalculo/clase3.pdf" }
        ],
        "Ejercicios": [
          { titulo: "Operaciones básicas y simplificación", archivo: "cursos/h2/modulo0.html" }
          // Si lo mueves: "cursos/precalculo/ejercicios/modulo0.html"
        ]
      }
    },

    "Teoría de números": {
      sections: {
        "Clases": [
          { titulo: "Motivación", archivo: "cursos/teoria de numeros/motivacion.pdf" },
          { titulo: "Principio de inducción", archivo: "cursos/teoria de numeros/Principio_induccion.pdf" }
        ],
        "Ejercicios": [
          { titulo: "Principio de Inducción Matemática", archivo: "cursos/teoria de numeros/PIM.pdf" }
        ]
      }
    }
  };
  // ==================================================================

  const yearEl = document.getElementById("year");
  yearEl.textContent = new Date().getFullYear();

  const courseFilter = document.getElementById("courseFilter");
  const qInput = document.getElementById("q");
  const root = document.getElementById("root");
  const gate = document.getElementById("gate");
  const gateInput = document.getElementById("gateInput");
  const gateBtn = document.getElementById("gateBtn");
  const gateErr = document.getElementById("gateErr");
  const changeKeyBtn = document.getElementById("changeKey");

  // Estado: curso permitido por clave (o null = todos)
  let ALLOWED = sessionStorage.getItem("allowedCourse") || null;

  // Parámetro URL ?clave=precalculo
  const urlKey = new URL(location.href).searchParams.get("clave");
  if (urlKey && CODES[urlKey.toLowerCase()]) {
    ALLOWED = CODES[urlKey.toLowerCase()];
    sessionStorage.setItem("allowedCourse", ALLOWED);
  }

  // Construir opciones del selector según ALLOWED
  function buildCourseOptions() {
    courseFilter.innerHTML = '<option value="">Todos los cursos</option>';
    const keys = Object.keys(DATA).sort().filter(k => !ALLOWED || k === ALLOWED);
    keys.forEach(curso => {
      const opt = document.createElement("option");
      opt.value = curso;
      opt.textContent = curso;
      courseFilter.appendChild(opt);
    });
  }

  // Badge por extensión
  function badgeFor(file) {
    const ext = (file.split(".").pop() || "").toLowerCase();
    if (ext === "pdf") return "PDF";
    if (ext === "html" || ext === "htm") return "HTML";
    return "Recurso";
  }

  // Fila de recurso con cache-busting (?v=SITE_VERSION)
  function makeItemRow(item) {
    const row = document.createElement("div");
    row.className = "pdf";

    const link = document.createElement("a");
    const url = new URL(item.archivo, location.href);
    url.searchParams.set("v", SITE_VERSION);
    link.href = url.toString();
    link.target = "_blank";
    link.rel = "noopener";
    link.textContent = item.titulo;

    const badge = document.createElement("span");
    badge.className = "badge";
    badge.textContent = badgeFor(item.archivo);

    row.appendChild(link);
    row.appendChild(badge);
    return row;
  }

  function render() {
    const q = qInput.value.trim().toLowerCase();
    const only = courseFilter.value;
    root.innerHTML = "";

    const entries = Object.entries(DATA)
      .filter(([curso]) => (!only || curso === only) && (!ALLOWED || curso === ALLOWED));

    if (entries.length === 0) {
      root.innerHTML = "<p>No hay cursos para mostrar.</p>";
      return;
    }

    for (const [curso, contenido] of entries) {
      const wrap = document.createElement("section");
      wrap.className = "course";

      const h2 = document.createElement("h2");
      h2.textContent = curso;
      wrap.appendChild(h2);

      // Caso array simple (por si agregas cursos sin secciones)
      if (Array.isArray(contenido)) {
        const list = document.createElement("div");
        list.className = "list";

        const filtered = contenido.filter(i =>
          !q || i.titulo.toLowerCase().includes(q) || i.archivo.toLowerCase().includes(q)
        );

        if (filtered.length === 0) {
          const p = document.createElement("p");
          p.textContent = "No hay resultados en este curso para tu búsqueda.";
          list.appendChild(p);
        } else {
          filtered.forEach(item => list.appendChild(makeItemRow(item)));
        }

        wrap.appendChild(list);
        root.appendChild(wrap);
        continue;
      }

      // Caso objeto con secciones
      if (contenido && contenido.sections && typeof contenido.sections === "object") {
        const secciones = Object.keys(contenido.sections);
        let hayAlgo = false;

        secciones.forEach((nombreSeccion, idx) => {
          const det = document.createElement("details");
          det.className = "details";
          if (idx === 0) det.open = true;

          const sum = document.createElement("summary");
          sum.textContent = nombreSeccion;
          det.appendChild(sum);

          const list = document.createElement("div");
          list.className = "list";

          const items = contenido.sections[nombreSeccion] || [];
          const filtered = items.filter(i =>
            !q || i.titulo.toLowerCase().includes(q) || i.archivo.toLowerCase().includes(q)
          );

          if (filtered.length === 0) {
            const p = document.createElement("p");
            p.textContent = "No hay resultados en esta sección para tu búsqueda.";
            list.appendChild(p);
          } else {
            hayAlgo = true;
            filtered.forEach(item => list.appendChild(makeItemRow(item)));
          }

          det.appendChild(list);
          wrap.appendChild(det);
        });

        if (!hayAlgo && q) {
          const p = document.createElement("p");
          p.textContent = "No hay resultados en este curso para tu búsqueda.";
          wrap.appendChild(p);
        }

        root.appendChild(wrap);
      }
    }
  }

  // Puerta de acceso
  function openGate() {
    gate.classList.add("show");
    gate.setAttribute("aria-hidden", "false");
    gateInput.value = "";
    gateErr.textContent = "";
    setTimeout(() => gateInput.focus(), 0);
  }
  function closeGate() {
    gate.classList.remove("show");
    gate.setAttribute("aria-hidden", "true");
  }
  function submitGate() {
    const raw = (gateInput.value || "").trim().toLowerCase();
    const course = CODES[raw];
    if (!course) {
      gateErr.textContent = "Clave inválida. Prueba: precalculo o teoriadenumeros.";
      return;
    }
    ALLOWED = course;
    sessionStorage.setItem("allowedCourse", ALLOWED);
    closeGate();
    buildCourseOptions();
    render();
  }

  gateBtn.addEventListener("click", submitGate);
  gateInput.addEventListener("keydown", e => { if (e.key === "Enter") submitGate(); });
  changeKeyBtn.addEventListener("click", () => {
    ALLOWED = null;
    sessionStorage.removeItem("allowedCourse");
    buildCourseOptions();
    render();
    openGate();
  });

  // Inicializar
  buildCourseOptions();
  if (!ALLOWED) openGate();   // Mostrar puerta si no hay clave aún
  qInput.addEventListener("input", render);
  courseFilter.addEventListener("change", render);
  render();
  </script>
</body>
</html>


